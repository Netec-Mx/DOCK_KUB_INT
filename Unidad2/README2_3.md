
# Práctica 2.3 Configuración de un Contenedor Oracle DB con Docker Compose.

## Objetivo

Al finalizar esta práctica, serás capaz de definir un contenedor de Oracle Database en un archivo docker-compose.yml, configurando variables de entorno, volúmenes y redes personalizadas.

## Duración

25 minutos


## Material Necesario

- Docker y Docker Compose instalados.

- Acceso a la terminal o consola.

- Un editor de texto para crear el archivo `docker-compose.yml`.


<br/>

## Instrucciones

## Paso 1. Preparar el entorno

1. Crea un directorio de trabajo para esta práctica:

```cmd
mkdir practica_2_3_oracle
cd practica_2_3_oracle
```

2. Crea un archivo vacío llamado `docker-compose.yml`:

```cmd
touch docker-compose.yml
```

3. Crea una carpeta local llamada `scripts` en el mismo directorio donde está el archivo ```docker-compose.yml``` y coloca ahí el archivo ```init_schema.sql```:

```cmd
mkdir scripts
cd scripts
touch init_schema.sql
code init_schema.sql
```

4. Copia el siguiente contenido a tu archivo SQL.

```sql
-- Crear un esquema y asignar permisos
CREATE USER dkuser IDENTIFIED BY dkpassword;
GRANT CONNECT, RESOURCE TO dkuser;

-- Crear una tabla en el esquema
CREATE TABLE dkuser.productos (
    id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR2(100),
    price NUMBER
);

-- Insertar datos iniciales
INSERT INTO my_schema.products (name, price) VALUES ('Product A', 200);
INSERT INTO my_schema.products (name, price) VALUES ('Product B', 300);
COMMIT;

```
<br/>

## Paso 2. Crear el archivo `docker-compose.yml`

Abre el archivo en tu editor de texto y escribe la siguiente configuración:

```yaml
version: "3.9"
services:
  dki-oracle-db:
    container_name: dki-oracle-container   
    image: container-registry.oracle.com/database/express:21.3.0-xe   
    environment:
      ORACLE_PASSWORD: Netec_123   
    ports:
      - "1521:1521"  
      - "5500:5500"   
    volumes:
      - dki-oracle-data:/opt/oracle/oradata   
      - ./scripts:/opt/oracle/scripts/setup  # Montar el directorio de scripts
    networks:
      - dki-network  # Red personalizada
volumes:
  dki-oracle-data:  # Volumen persistente para datos de Oracle Database
networks:
  dki-network:  # Red personalizada para comunicación

```
<br/>

## Paso 3. Análisis del `docker-compose.yml`

1. ¿Qué versión del esquema YAML se está utilizando?

2. ¿Cuál es el nombre del servicio definido en el archivo?

3. ¿Cuál es el nombre del contenedor asociado al servicio?

4. ¿Qué versión del servidor de base de datos Oracle se está configurando?

5. ¿Quiénes son los usuarios administradores de la base de datos?

6. ¿Cuál es la contraseña del servidor de base de datos Oracle?

7. ¿Cuáles son los nombres y contraseñas de los usuarios no administrativos?

8. ¿Qué puertos TCP/IP se exponen y cuál es la funcionalidad asociada a cada uno de ellos?

9. ¿Qué nombre tienen el volumen y la red creados para este servicio?

<br/>

## Paso 4. Validar el archivo YAML

Valida la sintaxis del archivo antes de ejecutarlo:

```cmd
docker-compose config
```
<br/>

## Paso 5. Levantar el contendor

Ejecuta el comando para iniciar el contenedor

```cmd
docker-compose up -d
```

<br/>

## Paso 6. Verificar que Oracle Database está funcionando

1. Consultar la bitácora del contenedor

```cmd
docker logs -f dki-oracle-container
```

Busca la línea que indique que la base de datos está lista.

2. Conectar a Oracle con SQL*Plus

Abre una terminal y conecta al contenedor usando `docker exec`

```cmd
docker exec -it dki-oracle-container sqlplus system/Netec_123@localhost:1521/XEPDB1
```

3. Consulta el estado de la base de datos

Ejecuta el siguiente comando en SQL*Plus:

```cmd
SELECT name, open_mode FROM v$pdbs;

SELECT * FROM dkuser.products;

```
<br/>

## Paso 7. Detén y elimina el contenedor

Cuando termines, detén y elimina todos los recursos creados:

```cmd
docker-compose down --volumes

```

<br/>

## Notas 
1. Puedes tener **múltiples scripts** en el directorio `scripts`, y se ejecutarán en orden alfabético.

2. Para configuraciones avanzadas, puedes incluir scripts en PL/SQL o configurar roles y permisos adicionales.

<br/>
<br/>

## Resultados Esperados

- Crear un archivo `docker-compose.yml` funcional que define un contenedor de Oracle Database.

- Contenedor de Oracle Database corriendo en los puertos `1521` y `5500`, con persistencia de datos y un usuario de aplicación configurado.

- Capacidad para conectarte al contenedor y realizar consultas básicas en la base de datos.